"use strict";(self.webpackChunkarabic_mandi=self.webpackChunkarabic_mandi||[]).push([[13],{7013:(Rt,q,m)=>{m.r(q),m.d(q,{CreateOfferModule:()=>Vt});var h=m(6814),M=m(5310),J=m(130),_=m(2939),G=m(7619),C=m(92),F=m(6306),Y=m(2096),t=m(5879);let y=(()=>{class i{constructor(e,a,n,o,f){this.GetItemEntitiesGQL=e,this.CreateManyOfferGQL=a,this.GetAlloffersGQL=n,this.UpdateOneOfferGQL=o,this._snackBar=f}find(e){return this.GetItemEntitiesGQL.watch(e).valueChanges.pipe((0,F.K)(()=>(0,Y.of)({data:null})))}GetAllOffers(e){return this.GetAlloffersGQL.watch(e).valueChanges.pipe((0,F.K)(()=>(0,Y.of)({data:null})))}updateOneOffer(e){return new G.y(a=>{const n=this._snackBar;this.UpdateOneOfferGQL.mutate(e).subscribe(({data:o})=>{o&&(n.open("Offer Updated"),a.next(!0),a.complete())},o=>{a.next(!1),a.complete(),this._snackBar.open("Having some error"+o)})})}AddAllOffers(e){this.CreateManyOfferGQL.mutate({input:e}).subscribe(({data:a})=>{a&&this._snackBar.open("Offers has been added")},a=>{this._snackBar.open("Haveing some error"+a)})}static#t=this.\u0275fac=function(a){return new(a||i)(t.LFG(C.tx),t.LFG(C.Z4),t.LFG(C.Dw),t.LFG(C.RX),t.LFG(_.ux))};static#e=this.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var O=m(1896),x=m(9288),r=m(6223),D=m(5619),Z=m(7394),v=m(3620),I=m(4664),b=m(7700),g=m(1476),l=m(5313),A=m(2296),j=m(5986),p=m(9157),w=m(617),S=m(2032);function V(i,s){1&i&&(t.TgZ(0,"th",13),t._uU(1,"Select"),t.qZA())}function R(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"td",14)(1,"mat-checkbox",15),t.NdJ("change",function(n){const f=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.onCheckboxChange(n,f))}),t.qZA()()}if(2&i){const e=s.$implicit;t.xp6(1),t.Q6J("checked",e.selected)}}function B(i,s){1&i&&(t.TgZ(0,"th",13),t._uU(1,"Name"),t.qZA())}function $(i,s){if(1&i&&(t.TgZ(0,"td",14),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.Oqu(e.name)}}function H(i,s){1&i&&(t.TgZ(0,"th",13),t._uU(1,"Quantity"),t.qZA())}function z(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",17)(1,"input",18),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.quantity=n)})("change",function(){t.CHM(e);const n=t.oxw().$implicit,o=t.oxw();return t.KtG(o.onQuantityChange(n))}),t.qZA()()}if(2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",e.quantity)}}function L(i,s){if(1&i&&(t.TgZ(0,"td",14),t.YNc(1,z,2,1,"div",16),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.Q6J("ngIf",e.selected)}}function P(i,s){1&i&&t._UZ(0,"tr",19)}function E(i,s){1&i&&t._UZ(0,"tr",20)}const X=function(){return[5]};let N=(()=>{class i{constructor(e,a){this.dialogRef=e,this.data=a,this.subs=new Z.w0,this.searchItems=new r.NI(null),this.dataSource=new l.by([]),this.displayedColumns=["select","name","quantity"],this.selectedItems=[],this.update=!1,this.showQuantityInput=!1,this.initializeData()}initializeData(){if(this.data?.itemEntities){const e=this.data.itemEntities.map(a=>({...a,selected:!1,quantity:1}));this.filteredDataSource=e.filter(a=>a.status)}else this.filteredDataSource=this.data.filter(e=>e.status),this.update=!0}ngOnInit(){this.init()}ngAfterViewInit(){this.dataSource.paginator=this.paginator}onCheckboxChange(e,a){const n=this.selectedItems.findIndex(f=>f===a),o=this.filteredDataSource.findIndex(f=>f.id===a.id);if(e.checked){if(-1===n){const f={...a,selected:!0,quantity:1};this.selectedItems.push(f)}-1!==o&&Object.isExtensible(this.filteredDataSource[o])&&(this.filteredDataSource[o].selected=!0)}else-1!==n&&this.selectedItems.splice(n,1),-1!==o&&Object.isExtensible(this.filteredDataSource[o])&&(this.filteredDataSource[o].selected=!1)}onQuantityChange(e){const a=this.selectedItems.findIndex(n=>n.id===e.id);-1!==a&&(this.selectedItems[a].quantity=e.quantity)}updateChange(e){this.dialogRef.close(e)}onAddItemsClick(){const e=this.filteredDataSource.filter(a=>a.selected);if(this.update)if(-1!=this.selectedItems.length){const a=Array.from(new Map([...e,...this.selectedItems].map(n=>[n.id,n])).values());this.updateChange(a)}else{const a=Array.from(new Map([...e,...this.selectedItems].map(n=>[n.id,n])).values());this.updateChange(a)}else{const a=Array.from(new Map([...this.selectedItems].map(n=>[n.id,n])).values());this.dialogRef.close(a)}}init(){this.dataSource=new l.by(this.filteredDataSource),this.subs.add(this.searchItems.valueChanges.subscribe(e=>{this.filteredDataSource||(this.filteredDataSource=[...this.dataSource.data]),this.dataSource.data=e?this.filteredDataSource.filter(a=>{const n=String(a.name).toLowerCase(),o=String(e).toLowerCase();return n.includes(o)}):this.filteredDataSource,this.dataSource.paginator=this.paginator}))}ngOnDestroy(){this.subs.unsubscribe()}static#t=this.\u0275fac=function(a){return new(a||i)(t.Y36(b.so),t.Y36(b.WI))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["Offer-item-dailog-view"]],viewQuery:function(a,n){if(1&a&&t.Gf(g.NW,5),2&a){let o;t.iGM(o=t.CRH())&&(n.paginator=o.first)}},decls:24,vars:7,consts:[[1,"search_update"],["matPrefix","",1,"material-icons-outlined"],["matInput","","placeholder","Find",3,"formControl"],["mat-flat-button","","color","primary",3,"click"],["mat-table","",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","quantity"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],[3,"checked","change"],["class","quantity-container",4,"ngIf"],[1,"quantity-container"],["mat-input","","type","number","min","1","inputmode","numeric",3,"ngModel","ngModelChange","change"],["mat-header-row",""],["mat-row",""]],template:function(a,n){1&a&&(t.TgZ(0,"section",0)(1,"mat-form-field")(2,"mat-label"),t._uU(3,"Search Item"),t.qZA(),t.TgZ(4,"mat-icon",1),t._uU(5,"search"),t.qZA(),t._UZ(6,"input",2),t.qZA(),t.TgZ(7,"button",3),t.NdJ("click",function(){return n.onAddItemsClick()}),t._uU(8),t.qZA()(),t._UZ(9,"br"),t.TgZ(10,"div")(11,"table",4),t.ynx(12,5),t.YNc(13,V,2,0,"th",6),t.YNc(14,R,2,1,"td",7),t.BQk(),t.ynx(15,8),t.YNc(16,B,2,0,"th",6),t.YNc(17,$,2,1,"td",7),t.BQk(),t.ynx(18,9),t.YNc(19,H,2,0,"th",6),t.YNc(20,L,2,1,"td",7),t.BQk(),t.YNc(21,P,1,0,"tr",10),t.YNc(22,E,1,0,"tr",11),t.qZA(),t._UZ(23,"mat-paginator",12),t.qZA()),2&a&&(t.xp6(6),t.Q6J("formControl",n.searchItems),t.xp6(2),t.hij(" ",n.update?"UpdateItem":"AddItem"," "),t.xp6(3),t.Q6J("dataSource",n.dataSource),t.xp6(10),t.Q6J("matHeaderRowDef",n.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",n.displayedColumns),t.xp6(1),t.Q6J("pageSizeOptions",t.DdM(6,X)))},dependencies:[h.O5,A.lW,j.oG,p.KE,p.hX,p.qo,w.Hw,S.Nt,g.NW,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,r.Fj,r.wV,r.JJ,r.qQ,r.On,r.oH],styles:[".quantity-container[_ngcontent-%COMP%]{display:flex;align-items:center}input[_ngcontent-%COMP%]{width:45px;text-align:center;-moz-appearance:textfield}.search_update[_ngcontent-%COMP%]{flex-direction:row;box-sizing:border-box;display:flex;place-content:space-between}@media only screen and (max-width: 724px){.search_update[_ngcontent-%COMP%]{display:block}}"]})}return i})();var W=m(8927);let U=(()=>{class i{constructor(e){this._auth=e,this.dataSubject=new D.X(null),this.data$=this.dataSubject.asObservable()}getCurrentUser(){const e=localStorage.getItem(this._auth.CURRENT_USER_KEY);return e?{id:JSON.parse(e).id}:null}setData(e){this.dataSubject.next(e)}static#t=this.\u0275fac=function(a){return new(a||i)(t.LFG(W.i))};static#e=this.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var k=m(3814),T=m(9038);function K(i,s){if(1&i&&(t.TgZ(0,"mat-list-item")(1,"div",12)(2,"span",13),t._uU(3),t.qZA(),t.TgZ(4,"span"),t._uU(5,":"),t.qZA(),t.TgZ(6,"span"),t._uU(7),t.qZA()()()),2&i){const e=s.$implicit;t.xp6(3),t.Oqu(e.name),t.xp6(4),t.hij(" ",e.quantity,"")}}function tt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",14,9),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.submitTableData())}),t._uU(2,"AddAllOffers"),t.qZA()}}function et(i,s){1&i&&(t.TgZ(0,"mat-header-cell")(1,"mat-icon"),t._uU(2," local_offer"),t.qZA()())}function it(i,s){if(1&i&&(t.TgZ(0,"mat-cell"),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.hij(" ",e.offerName," ")}}function at(i,s){1&i&&(t.TgZ(0,"mat-header-cell")(1,"mat-icon"),t._uU(2,"list"),t.qZA()())}function nt(i,s){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.AsE("",e.name,"=",e.quantity,",")}}function ot(i,s){if(1&i&&(t.TgZ(0,"mat-cell")(1,"div",30),t.YNc(2,nt,2,2,"span",6),t.qZA()()),2&i){const e=s.$implicit;t.xp6(2),t.Q6J("ngForOf",e.listOfItems)}}function st(i,s){1&i&&(t.TgZ(0,"mat-header-cell")(1,"mat-icon"),t._uU(2," attach_money"),t.qZA()())}function rt(i,s){if(1&i&&(t.TgZ(0,"mat-cell"),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.hij(" ",e.price," ")}}function lt(i,s){1&i&&(t.TgZ(0,"mat-header-cell")(1,"mat-icon"),t._uU(2," percentage"),t.qZA()())}function ct(i,s){if(1&i&&(t.TgZ(0,"mat-cell"),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.hij(" ",e.specialDiscount," ")}}function mt(i,s){1&i&&(t.TgZ(0,"mat-header-cell")(1,"mat-icon"),t._uU(2," attach_money"),t.qZA()())}function ft(i,s){if(1&i&&(t.TgZ(0,"mat-cell"),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.hij(" ",e.totalCostAfterDiscount," ")}}function ut(i,s){1&i&&(t.TgZ(0,"th",31)(1,"mat-icon"),t._uU(2,"delete"),t.qZA()())}function dt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"td",32)(1,"mat-icon",33),t.NdJ("click",function(){const o=t.CHM(e).$implicit,f=t.oxw(2);return t.KtG(f.onDeleteClick(o))}),t._uU(2,"delete"),t.qZA()()}}function pt(i,s){1&i&&t._UZ(0,"mat-header-row")}function ht(i,s){1&i&&t._UZ(0,"mat-row")}const _t=function(){return[8]};function gt(i,s){if(1&i&&(t.TgZ(0,"section",15)(1,"table",16),t.ynx(2,17),t.YNc(3,et,3,0,"mat-header-cell",18),t.YNc(4,it,2,1,"mat-cell",19),t.BQk(),t.ynx(5,20),t.YNc(6,at,3,0,"mat-header-cell",18),t.YNc(7,ot,3,1,"mat-cell",19),t.BQk(),t.ynx(8,21),t.YNc(9,st,3,0,"mat-header-cell",18),t.YNc(10,rt,2,1,"mat-cell",19),t.BQk(),t.ynx(11,22),t.YNc(12,lt,3,0,"mat-header-cell",18),t.YNc(13,ct,2,1,"mat-cell",19),t.BQk(),t.ynx(14,23),t.YNc(15,mt,3,0,"mat-header-cell",18),t.YNc(16,ft,2,1,"mat-cell",19),t.BQk(),t.ynx(17,24),t.YNc(18,ut,3,0,"th",25),t.YNc(19,dt,3,0,"td",26),t.BQk(),t.YNc(20,pt,1,0,"mat-header-row",27),t.YNc(21,ht,1,0,"mat-row",28),t.qZA(),t._UZ(22,"mat-paginator",29),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("dataSource",e.dataSource),t.xp6(19),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns),t.xp6(1),t.Q6J("pageSizeOptions",t.DdM(4,_t))}}class Q{constructor(){this.offerName="",this.listOfItems=[],this.price=0,this.specialDiscount=0,this.totalCostAfterDiscount=0}}let Ct=(()=>{class i{constructor(e,a,n,o,f,c){this.formBuilder=e,this._dialog=a,this._snackbar=n,this.cdr=o,this.commonService=f,this.offerService=c,this.checked=!1,this.offerData=[],this.displayedColumns=["offerName","listOfItems","price","specialDiscount","totalCostAfterDiscount","delete"],this.dataSetChange$=new D.X({filter:{},sorting:[]}),this.subs=new Z.w0}ngAfterViewInit(){this.updateTable()}ngOnInit(){this.initializeForm(),this.subscribeCategoryChanges()}subscribeCategoryChanges(){this.subs.add(this.dataSetChange$.pipe((0,v.b)(500),(0,I.w)(e=>this.offerService.find(e))).subscribe(({data:e})=>{e?.itemEntities&&(this.dataSourceItems=e)}))}ItemOfferDailogHandlar(){const e=this.offerForm.get("listOfItems")?.value;if(e&&e.length>0){const o=this.dataSourceItems.itemEntities.map(c=>({...c,quantity:1})).filter(c=>!e.some(u=>u.id===c.id)).concat(e).reverse();this._dialog.open(N,{data:o}).afterClosed().subscribe(c=>{c&&(this.offerForm.get("listOfItems")?.setValue(c),this.selectedItems=c)})}else this._dialog.open(N,{data:this.dataSourceItems}).afterClosed().subscribe(n=>{n&&(this.offerForm.get("listOfItems")?.setValue(n),this.selectedItems=n)})}onDeleteClick(e){const a=new _.u_;a.horizontalPosition="center",a.verticalPosition="top";const n=this._snackbar.open("Are you sure you want to delete this item?","Yes",a),o=this._snackbar.open("Item deleted","Undo",{duration:5e3});n.afterDismissed().subscribe(f=>{!0===f.dismissedByAction&&o.dismiss()}),o.afterDismissed().subscribe(f=>{if(!0===f.dismissedByAction)this._snackbar.open("Item is not removed","OK",a);else{const c=this.offerData.findIndex(u=>u===e);-1!==c&&this.offerData.splice(c,1),this.updateTable()}})}updateTable(){this.dataSource=new l.by(this.offerData),this.dataSource.paginator=this.paginator,this.cdr.detectChanges()}initializeForm(){this.offerModel=new Q,this.offerForm=this.formBuilder.group({offerName:[this.offerModel.offerName,r.kI.required],listOfItems:[this.offerModel.listOfItems,r.kI.required],price:[this.offerModel.price,[r.kI.required,r.kI.min(0)]],specialDiscount:[0,[r.kI.required,r.kI.min(0)]],totalCostAfterDiscount:[this.offerModel.totalCostAfterDiscount,r.kI.min(0)]}),this.offerForm.get("price")?.valueChanges.subscribe(()=>this.calculateTotalCost()),this.offerForm.get("specialDiscount")?.valueChanges.subscribe(()=>this.calculateTotalCost())}calculateTotalCost(){const e=this.offerForm.get("price")?.value,a=this.offerForm.get("specialDiscount")?.value,o=Math.floor(e-a/100*e);a>=e?this.offerForm.get("totalCostAfterDiscount")?.setValue(e):this.offerForm.get("totalCostAfterDiscount")?.setValue(o)}onSubmit(){this.offerForm.valid?(this.offerData.push(this.offerForm.value),this.updateTable(),this.selectedItems=[],this.offerForm.reset()):this._snackbar.open("Select Items ","close")}removeTypename(e){const a={};for(const n in e)"__typename"!==n&&(a[n]="object"==typeof e[n]?this.removeTypename(e[n]):e[n]);return a}submitTableData(){const e=this.commonService.getCurrentUser();if(this.offerData){const n={offers:this.offerData.map(o=>(console.log(o),{items:o.listOfItems.map(d=>this.removeTypename(d)).map(d=>({id:d.id,name:d.name,quantity:d.quantity,selected:d.selected,category:{id:d.category.id,name:d.category.name}})),createdby:e,name:o.offerName,status:!0,discount:o.specialDiscount,price:o.price,totalPrice:o.totalCostAfterDiscount}))};this.offerService.AddAllOffers(n)}}static#t=this.\u0275fac=function(a){return new(a||i)(t.Y36(r.qu),t.Y36(b.uw),t.Y36(_.ux),t.Y36(t.sBO),t.Y36(U),t.Y36(y))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["food-create-offer"]],viewQuery:function(a,n){if(1&a&&t.Gf(g.NW,5),2&a){let o;t.iGM(o=t.CRH())&&(n.paginator=o.first)}},decls:34,vars:5,consts:[[1,"outerDivStyle"],[1,"formStyle",3,"formGroup","ngSubmit"],["matInput","","id","offerName","formControlName","offerName"],["matInput","","id","price","formControlName","price","type","number"],["matInput","","id","specialDiscount","formControlName","specialDiscount","type","number"],["matInput","","id","totalCostAfterDiscount","formControlName","totalCostAfterDiscount","type","number","readonly",""],[4,"ngFor","ngForOf"],["role","button",1,"btn","btn-primary","btn-sm",3,"click"],["mat-raised-button","","color","primary","type","submit"],["paginator",""],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["class","mat-elevation-z8 table-Over-Flow-Globle",4,"ngIf"],["fxLayout","row","fxGap","8px",2,"justify-content","space-between"],[2,"overflow","hidden","text-overflow","ellipsis"],["mat-raised-button","","color","primary",3,"click"],[1,"mat-elevation-z8","table-Over-Flow-Globle"],["mat-table","",3,"dataSource"],["matColumnDef","offerName"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","listOfItems"],["matColumnDef","price"],["matColumnDef","specialDiscount"],["matColumnDef","totalCostAfterDiscount"],["matColumnDef","delete"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[3,"pageSizeOptions"],[2,"display","grid"],["mat-header-cell",""],["mat-cell",""],["color","warn",3,"click"]],template:function(a,n){1&a&&(t.TgZ(0,"div",0)(1,"form",1),t.NdJ("ngSubmit",function(){return n.onSubmit()}),t.TgZ(2,"mat-form-field")(3,"mat-label"),t._uU(4,"Offer Name"),t.qZA(),t._UZ(5,"input",2),t.qZA(),t.TgZ(6,"mat-form-field")(7,"mat-label"),t._uU(8,"Price"),t.qZA(),t._UZ(9,"input",3),t.qZA(),t.TgZ(10,"mat-form-field")(11,"mat-label"),t._uU(12,"Special Discount"),t.qZA(),t._UZ(13,"input",4),t.qZA(),t.TgZ(14,"mat-form-field")(15,"mat-label"),t._uU(16,"Total Cost After Discount"),t.qZA(),t._UZ(17,"input",5),t.qZA(),t.TgZ(18,"div")(19,"mat-list"),t.YNc(20,K,8,2,"mat-list-item",6),t.qZA()(),t._UZ(21,"br"),t.TgZ(22,"a",7),t.NdJ("click",function(){return n.ItemOfferDailogHandlar()}),t._uU(23),t.qZA(),t._UZ(24,"br"),t.TgZ(25,"button",8,9),t._uU(27,"AddToList"),t.qZA()(),t._UZ(28,"br"),t.qZA(),t._UZ(29,"br"),t.TgZ(30,"div"),t.YNc(31,tt,3,0,"button",10),t.qZA(),t._UZ(32,"br"),t.YNc(33,gt,23,5,"section",11)),2&a&&(t.xp6(1),t.Q6J("formGroup",n.offerForm),t.xp6(19),t.Q6J("ngForOf",n.selectedItems),t.xp6(3),t.hij(" ",n.selectedItems&&n.selectedItems.length>0?"UpdateItem":"SelectItem",""),t.xp6(8),t.Q6J("ngIf",n.offerData.length),t.xp6(2),t.Q6J("ngIf",n.offerData.length))},dependencies:[h.sg,h.O5,k.xw,A.lW,p.KE,p.hX,w.Hw,S.Nt,T.i$,T.Tg,g.NW,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk,r._Y,r.Fj,r.wV,r.JJ,r.JL,r.sg,r.u],styles:[".formStyle[_ngcontent-%COMP%]{display:grid;justify-items:unset;padding-top:10px}.outerDivStyle[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}@media (max-width: 480px){.formStyle[_ngcontent-%COMP%]{display:grid;justify-items:unset}.outerDivStyle[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}}@media (min-width: 480px) and (max-width: 1050px){.formStyle[_ngcontent-%COMP%]{display:grid;justify-items:unset;padding-left:50px}.outerDivStyle[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}}"]})}return i})();var yt=m(7988),Ot=m(2599);function Dt(i,s){1&i&&(t.TgZ(0,"mat-header-cell"),t._uU(1," Status "),t.qZA())}function Zt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"mat-cell")(1,"mat-slide-toggle",16),t.NdJ("change",function(n){const f=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.onStatusChange(n,f))}),t.qZA()()}if(2&i){const e=s.$implicit;t.xp6(1),t.Q6J("checked",e.status)}}function bt(i,s){1&i&&(t.TgZ(0,"mat-header-cell")(1,"mat-icon"),t._uU(2," local_offer"),t.qZA()())}function Tt(i,s){if(1&i&&(t.TgZ(0,"mat-cell"),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}function xt(i,s){1&i&&(t.TgZ(0,"mat-header-cell")(1,"mat-icon"),t._uU(2,"list"),t.qZA()())}function vt(i,s){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.AsE("",e.name,"=",e.quantity,"")}}function It(i,s){if(1&i&&(t.TgZ(0,"mat-cell")(1,"div",17),t.YNc(2,vt,2,2,"span",18),t.qZA()()),2&i){const e=s.$implicit;t.xp6(2),t.Q6J("ngForOf",e.items)}}function At(i,s){1&i&&(t.TgZ(0,"mat-header-cell")(1,"mat-icon"),t._uU(2," attach_money"),t.qZA()())}function wt(i,s){if(1&i&&(t.TgZ(0,"mat-cell"),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.hij(" ",e.price," ")}}function St(i,s){1&i&&(t.TgZ(0,"mat-header-cell")(1,"mat-icon"),t._uU(2," attach_money"),t.qZA()())}function Nt(i,s){if(1&i&&(t.TgZ(0,"mat-cell"),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.hij(" ",e.totalPrice," ")}}function Ut(i,s){1&i&&(t.TgZ(0,"th",19),t._uU(1,"Actions"),t.qZA())}function qt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"td",20)(1,"button",21),t.NdJ("click",function(){const o=t.CHM(e).$implicit,f=t.oxw();return t.KtG(f.UpdateHandlerTable(o))}),t.TgZ(2,"mat-icon",22),t._uU(3,"edit"),t.qZA()()()}}function Ft(i,s){1&i&&t._UZ(0,"mat-header-row")}function Yt(i,s){1&i&&t._UZ(0,"mat-row")}const kt=function(){return[10]};function Mt(i,s){if(1&i&&(t.TgZ(0,"mat-list-item")(1,"div",10)(2,"span",11),t._uU(3),t.qZA(),t.TgZ(4,"span"),t._uU(5,":"),t.qZA(),t.TgZ(6,"span"),t._uU(7),t.qZA()()()),2&i){const e=s.$implicit;t.xp6(3),t.Oqu(e.name),t.xp6(4),t.hij(" ",e.quantity,"")}}const Gt=[{path:"",pathMatch:"full",canActivate:[x.u],component:Ct},{path:"View_Offers",component:(()=>{class i{constructor(e,a,n,o){this._snackbar=e,this.offerService=a,this._router=n,this._commonService=o,this.dataSetChange$=new D.X({filter:{},sorting:[]}),this.checked=!1,this.offerData=[],this.displayedColumns=["status","offerName","listOfItems","price","totalCostAfterDiscount","actions"],this.subs=new Z.w0}onStatusChange(e,a){e.checked?this.offerService.updateOneOffer({input:{id:a.id,update:{updatedby:{id:a.updatedby.id},status:!0}}}).subscribe(o=>{this._snackbar.open("Item Is Active Now")}):this.offerService.updateOneOffer({input:{id:a.id,update:{updatedby:{id:a.updatedby.id},status:!1}}}).subscribe(o=>{this._snackbar.open("Item Is Not Active")})}ngAfterViewInit(){this.initData()}initData(){this.subs.add(this.dataSetChange$.pipe((0,v.b)(500),(0,I.w)(e=>this.offerService.GetAllOffers(e))).subscribe(({data:e})=>{e?.offers&&(this.dataSource=new l.by(e?.offers),this.dataSource.paginator=this.paginator)}))}UpdateHandlerTable(e){this._commonService.setData(e),this._router.navigate(["admin/offer/update_item"])}ngOnDestroy(){this.subs.unsubscribe()}static#t=this.\u0275fac=function(a){return new(a||i)(t.Y36(_.ux),t.Y36(y),t.Y36(O.F0),t.Y36(U))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["offer-view"]],viewQuery:function(a,n){if(1&a&&t.Gf(g.NW,5),2&a){let o;t.iGM(o=t.CRH())&&(n.paginator=o.first)}},decls:28,vars:5,consts:[[1,"table-Over-Flow-Globle","mat-elevation-z8"],["mat-table","",3,"dataSource"],["matColumnDef","status"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","offerName"],["matColumnDef","listOfItems"],["matColumnDef","price"],["matColumnDef","totalCostAfterDiscount"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[2,"width","initial",3,"pageSizeOptions"],["paginator",""],[3,"checked","change"],[2,"display","grid"],[4,"ngFor","ngForOf"],["mat-header-cell",""],["mat-cell",""],["mat-menu-item","",3,"click"],[1,"material-icons-outlined"]],template:function(a,n){1&a&&(t.TgZ(0,"div")(1,"div")(2,"h3"),t._uU(3,"All Offer's"),t.qZA()()(),t.TgZ(4,"section",0)(5,"table",1),t.ynx(6,2),t.YNc(7,Dt,2,0,"mat-header-cell",3),t.YNc(8,Zt,2,1,"mat-cell",4),t.BQk(),t.ynx(9,5),t.YNc(10,bt,3,0,"mat-header-cell",3),t.YNc(11,Tt,2,1,"mat-cell",4),t.BQk(),t.ynx(12,6),t.YNc(13,xt,3,0,"mat-header-cell",3),t.YNc(14,It,3,1,"mat-cell",4),t.BQk(),t.ynx(15,7),t.YNc(16,At,3,0,"mat-header-cell",3),t.YNc(17,wt,2,1,"mat-cell",4),t.BQk(),t.ynx(18,8),t.YNc(19,St,3,0,"mat-header-cell",3),t.YNc(20,Nt,2,1,"mat-cell",4),t.BQk(),t.ynx(21,9),t.YNc(22,Ut,2,0,"th",10),t.YNc(23,qt,4,0,"td",11),t.BQk(),t.YNc(24,Ft,1,0,"mat-header-row",12),t.YNc(25,Yt,1,0,"mat-row",13),t.qZA(),t._UZ(26,"mat-paginator",14,15),t.qZA()),2&a&&(t.xp6(5),t.Q6J("dataSource",n.dataSource),t.xp6(19),t.Q6J("matHeaderRowDef",n.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",n.displayedColumns),t.xp6(1),t.Q6J("pageSizeOptions",t.DdM(4,kt)))},dependencies:[h.sg,w.Hw,yt.OP,g.NW,Ot.Rr,l.BZ,l.fO,l.as,l.w1,l.Dz,l.nj,l.ge,l.ev,l.XQ,l.Gk],encapsulation:2})}return i})(),canActivate:[x.u]},{path:"update_item",component:(()=>{class i{constructor(e,a,n,o,f,c){this._fb=e,this.commonService=a,this._dialog=n,this._router=o,this._snackbar=f,this._createService=c,this.dataSetChange$=new D.X({filter:{},sorting:[]}),this.subs=new Z.w0,this.offerData=[],this.itemList=[],this.initializeForm()}initializeForm(){this.offerModel=new Q,this.offerForm=this._fb.group({offerName:[this.offerModel.offerName,r.kI.required],listOfItems:[this.offerModel.listOfItems,r.kI.required],price:[this.offerModel.price,[r.kI.required,r.kI.min(0)]],specialDiscount:[0,[r.kI.required,r.kI.min(0)]],totalCostAfterDiscount:[this.offerModel.totalCostAfterDiscount,r.kI.min(0)]}),this.offerForm.get("price")?.valueChanges.subscribe(()=>this.calculateTotalCost()),this.offerForm.get("specialDiscount")?.valueChanges.subscribe(()=>this.calculateTotalCost()),this.initializeData()}initializeData(){this.commonService.data$.subscribe(e=>{null===e?this._router.navigate(["admin/offer/View_Offers"]):(this.subs.add(this.dataSetChange$.pipe((0,v.b)(500),(0,I.w)(a=>this._createService.find(a))).subscribe(({data:a})=>{a?.itemEntities&&(this.itemList=a?.itemEntities)})),this.selectedItems=e.items,this.id=e.id,this.offerForm.get("listOfItems")?.setValue(e.items),this.offerForm.get("offerName")?.setValue(e.name),this.offerForm.get("price")?.setValue(e.price),this.offerForm.get("specialDiscount")?.setValue(e.discount),this.offerForm.get("totalCostAfterDiscount")?.setValue(e.totalPrice))})}calculateTotalCost(){const e=this.offerForm.get("price")?.value,a=this.offerForm.get("specialDiscount")?.value,o=Math.floor(e-a/100*e);a>=e?this.offerForm.get("totalCostAfterDiscount")?.setValue(e):this.offerForm.get("totalCostAfterDiscount")?.setValue(o)}ItemOfferDailogHandlar(){const e=this.offerForm.get("listOfItems")?.value;if(e&&e.length>0){const o=this.itemList.map(c=>({...c,quantity:1,selected:!1})).filter(c=>!e.some(u=>parseInt(u.id)===c.id)).concat(e.map(c=>({...c,quantity:c.quantity}))).reverse();this._dialog.open(N,{data:o}).afterClosed().subscribe(c=>{c&&(this.offerForm.get("listOfItems")?.setValue(c),this.selectedItems=c)})}}removeTypename(e){const a={};for(const n in e)"__typename"!==n&&(a[n]="object"==typeof e[n]?this.removeTypename(e[n]):e[n]);return a}onSubmit(){if(this.offerForm.valid){const e=this.commonService.getCurrentUser(),a=this.offerForm.value,o=a.listOfItems.map(u=>this.removeTypename(u)).map(u=>({id:parseInt(u.id),name:u.name,quantity:u.quantity,selected:u.selected,category:{id:u.category.id,name:u.category.name}}));this._createService.updateOneOffer({input:{id:this.id,update:{name:a.offerName,updatedby:e,discount:a.specialDiscount,price:a.price,totalPrice:a.totalCostAfterDiscount,status:!0,items:o}}}).subscribe(u=>{u&&setTimeout(()=>{this._router.navigateByUrl("admin/offer/View_Offers").then(()=>{location.reload()})},1e3)})}}ngAfterViewInit(){}static#t=this.\u0275fac=function(a){return new(a||i)(t.Y36(r.qu),t.Y36(U),t.Y36(b.uw),t.Y36(O.F0),t.Y36(_.ux),t.Y36(y))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["offer-update"]],decls:28,vars:4,consts:[[1,"outerDivStyle"],[1,"formStyle",3,"formGroup","ngSubmit"],["matInput","","id","offerName","formControlName","offerName"],["matInput","","id","price","formControlName","price","type","number"],["matInput","","id","specialDiscount","formControlName","specialDiscount","type","number"],["matInput","","id","totalCostAfterDiscount","formControlName","totalCostAfterDiscount","type","number","readonly",""],[4,"ngFor","ngForOf"],["role","button",1,"btn","btn-primary","btn-sm",3,"click"],["mat-raised-button","","color","primary","type","submit"],["paginator",""],["fxLayout","row","fxGap","8px",2,"justify-content","space-between"],[2,"overflow","hidden","text-overflow","ellipsis"]],template:function(a,n){1&a&&(t.TgZ(0,"div",0)(1,"form",1),t.NdJ("ngSubmit",function(){return n.onSubmit()}),t.TgZ(2,"mat-form-field")(3,"mat-label"),t._uU(4,"Offer Name"),t.qZA(),t._UZ(5,"input",2),t.qZA(),t.TgZ(6,"mat-form-field")(7,"mat-label"),t._uU(8,"Price"),t.qZA(),t._UZ(9,"input",3),t.qZA(),t.TgZ(10,"mat-form-field")(11,"mat-label"),t._uU(12,"Special Discount"),t.qZA(),t._UZ(13,"input",4),t.qZA(),t.TgZ(14,"mat-form-field")(15,"mat-label"),t._uU(16,"Total Cost After Discount"),t.qZA(),t._UZ(17,"input",5),t.qZA(),t.TgZ(18,"div")(19,"mat-list"),t.YNc(20,Mt,8,2,"mat-list-item",6),t.qZA()(),t._UZ(21,"br"),t.TgZ(22,"a",7),t.NdJ("click",function(){return n.ItemOfferDailogHandlar()}),t._uU(23),t.qZA(),t._UZ(24,"br"),t.TgZ(25,"button",8,9),t._uU(27),t.qZA()()()),2&a&&(t.xp6(1),t.Q6J("formGroup",n.offerForm),t.xp6(19),t.Q6J("ngForOf",n.selectedItems),t.xp6(3),t.hij(" ",n.itemList&&n.itemList.length>0?"Update Items":"SelectItem",""),t.xp6(4),t.Oqu(n.itemList&&n.itemList.length>0?"Submit":"SelectItem"))},dependencies:[h.sg,k.xw,A.lW,p.KE,p.hX,S.Nt,T.i$,T.Tg,r._Y,r.Fj,r.wV,r.JJ,r.JL,r.sg,r.u],styles:[".formStyle[_ngcontent-%COMP%]{display:grid;justify-items:unset;padding-top:10px}.outerDivStyle[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}@media (max-width: 480px){.formStyle[_ngcontent-%COMP%]{display:grid;justify-items:unset}.outerDivStyle[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}}@media (min-width: 480px) and (max-width: 1050px){.formStyle[_ngcontent-%COMP%]{display:grid;justify-items:unset;padding-left:50px}.outerDivStyle[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}}"]})}return i})(),canActivate:[x.u]}];let jt=(()=>{class i{static#t=this.\u0275fac=function(a){return new(a||i)};static#e=this.\u0275mod=t.oAB({type:i});static#i=this.\u0275inj=t.cJS({imports:[O.Bz.forChild(Gt),O.Bz]})}return i})(),Vt=(()=>{class i{static#t=this.\u0275fac=function(a){return new(a||i)};static#e=this.\u0275mod=t.oAB({type:i});static#i=this.\u0275inj=t.cJS({providers:[y],imports:[h.ez,J.q,M.I,_.ZX,jt]})}return i})()}}]);